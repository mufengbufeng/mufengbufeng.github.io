

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="rgba(47, 65, 84, 0.9)">
  <meta name="author" content="SuHang">
  <meta name="keywords" content="">
  
    <meta name="description" content="俄罗斯方块这是独立游戏页面。                                    分数         0                       消行         0                       等级         1                       状态         进行中                        下一个方块">
<meta property="og:type" content="website">
<meta property="og:title" content="俄罗斯方块">
<meta property="og:url" content="https://lshgame.com/games/tetris/index.html">
<meta property="og:site_name" content="苏杭小站">
<meta property="og:description" content="俄罗斯方块这是独立游戏页面。                                    分数         0                       消行         0                       等级         1                       状态         进行中                        下一个方块">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2026-02-21T13:21:00.000Z">
<meta property="article:modified_time" content="2026-02-21T13:10:30.642Z">
<meta property="article:author" content="SuHang">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>俄罗斯方块 - 苏杭小站</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />





<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/mouse.css">
<link rel="stylesheet" href="/css/cool-effects.css">
<link rel="stylesheet" href="/css/code-enhanced.css">
<link rel="stylesheet" href="/css/sidebar-widgets.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"lshgame.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#667eea","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":false,"baidu":null,"google":{"measurement_id":"G-6BJRKXXJ1M"},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-6BJRKXXJ1M", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-6BJRKXXJ1M');
        });
      }
    </script>
  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 60vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>苏杭小站</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                
                <span>游戏</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/games/" target="_self">
                    
                    <span>游戏首页</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/games/tetris/" target="_self">
                    
                    <span>俄罗斯方块</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="俄罗斯方块"></span>
          
        </div>

        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      <div class="container nopadding-x-md">
        <div id="board"
          >
          
          <div class="container">
            <div class="row">
              <div class="col-12 col-md-10 m-auto">
                

<article class="page-content">
  <h2 id="俄罗斯方块"><a href="#俄罗斯方块" class="headerlink" title="俄罗斯方块"></a>俄罗斯方块</h2><p>这是独立游戏页面。</p>
<div id="games-tetris" class="about-tetris">
  <div class="about-tetris__board-wrap">
    <canvas class="about-tetris__board" data-role="board" aria-label="俄罗斯方块棋盘"></canvas>
  </div>
  <div class="about-tetris__panel">
    <div class="about-tetris__hud">
      <div class="about-tetris__stat">
        <span>分数</span>
        <strong data-role="score">0</strong>
      </div>
      <div class="about-tetris__stat">
        <span>消行</span>
        <strong data-role="lines">0</strong>
      </div>
      <div class="about-tetris__stat">
        <span>等级</span>
        <strong data-role="level">1</strong>
      </div>
      <div class="about-tetris__stat">
        <span>状态</span>
        <strong data-role="state">进行中</strong>
      </div>
    </div>
    <div class="about-tetris__next">
      <div class="about-tetris__next-title">下一个方块</div>
      <canvas class="about-tetris__next-board" data-role="next" aria-label="下一个方块预览"></canvas>
    </div>
    <div class="about-tetris__controls" data-role="controls">
      <button type="button" data-action="start">开始</button>
      <button type="button" data-action="left">左移</button>
      <button type="button" data-action="right">右移</button>
      <button type="button" data-action="rotate">旋转</button>
      <button type="button" data-action="down">下落</button>
      <button type="button" data-action="drop">速降</button>
      <button type="button" data-action="restart">重开</button>
    </div>
    <p class="about-tetris__hint">先点开始。键盘：Enter 开始，← → 移动，↑ 旋转，↓ 下落，空格速降，R 重开</p>
  </div>
</div>

<style>
  .about-tetris {
    --tetris-bg: #0f172a;
    --tetris-bg-soft: #111827;
    --tetris-border: #1f2937;
    --tetris-text: #e5e7eb;
    --tetris-accent: #22c55e;
    display: grid;
    grid-template-columns: minmax(220px, 240px) minmax(240px, 1fr);
    gap: 1rem;
    align-items: flex-start;
    margin: 1.25rem 0 0.5rem;
    padding: 1rem;
    border: 1px solid var(--tetris-border);
    border-radius: 14px;
    background: linear-gradient(145deg, #0b1222, #0f172a 45%, #111827);
    color: var(--tetris-text);
  }

  .about-tetris__board-wrap {
    width: 100%;
    max-width: 240px;
  }

  .about-tetris__board {
    width: 100%;
    height: auto;
    border: 1px solid var(--tetris-border);
    border-radius: 8px;
    background: var(--tetris-bg);
    display: block;
    margin: 0 auto;
  }

  .about-tetris__panel {
    display: grid;
    gap: 0.9rem;
  }

  .about-tetris__hud {
    display: grid;
    grid-template-columns: repeat(2, minmax(100px, 1fr));
    gap: 0.6rem;
  }

  .about-tetris__stat {
    border: 1px solid var(--tetris-border);
    border-radius: 8px;
    background: rgba(17, 24, 39, 0.72);
    padding: 0.5rem 0.65rem;
    display: grid;
    gap: 0.1rem;
    line-height: 1.2;
  }

  .about-tetris__stat span {
    font-size: 0.82rem;
    opacity: 0.85;
  }

  .about-tetris__stat strong {
    font-size: 1.05rem;
  }

  .about-tetris__next {
    border: 1px solid var(--tetris-border);
    border-radius: 8px;
    padding: 0.5rem 0.65rem 0.7rem;
    background: rgba(17, 24, 39, 0.72);
  }

  .about-tetris__next-title {
    font-size: 0.84rem;
    margin-bottom: 0.45rem;
    opacity: 0.9;
  }

  .about-tetris__next-board {
    width: 96px;
    height: 96px;
    border: 1px solid var(--tetris-border);
    border-radius: 8px;
    background: var(--tetris-bg-soft);
    display: block;
  }

  .about-tetris__controls {
    display: grid;
    grid-template-columns: repeat(3, minmax(68px, 1fr));
    gap: 0.5rem;
  }

  .about-tetris__controls button {
    appearance: none;
    border: 1px solid #2d3f57;
    border-radius: 7px;
    background: #142236;
    color: var(--tetris-text);
    padding: 0.42rem 0.36rem;
    font-size: 0.86rem;
    cursor: pointer;
    transition: background 0.16s ease, border-color 0.16s ease, transform 0.12s ease;
  }

  .about-tetris__controls button:hover {
    background: #1a304a;
    border-color: #3d5a7b;
  }

  .about-tetris__controls button[data-action="start"] {
    background: #14532d;
    border-color: #166534;
  }

  .about-tetris__controls button[data-action="start"]:hover {
    background: #166534;
    border-color: #22c55e;
  }

  .about-tetris__controls button:active {
    transform: translateY(1px);
  }

  .about-tetris__controls button:focus-visible {
    outline: 2px solid var(--tetris-accent);
    outline-offset: 1px;
  }

  .about-tetris__hint {
    margin: 0;
    font-size: 0.84rem;
    opacity: 0.86;
    line-height: 1.35;
  }

  @media (max-width: 768px) {
    .about-tetris {
      grid-template-columns: 1fr;
      justify-items: center;
      padding: 0.85rem;
    }

    .about-tetris__panel {
      width: min(420px, 100%);
    }
  }
</style>

<script>
  (() => {
    const root = document.getElementById("games-tetris");
    if (!root) return;

    if (typeof window.__gamesTetrisCleanup === "function") {
      window.__gamesTetrisCleanup();
    }

    const boardCanvas = root.querySelector('[data-role="board"]');
    const nextCanvas = root.querySelector('[data-role="next"]');
    const scoreEl = root.querySelector('[data-role="score"]');
    const linesEl = root.querySelector('[data-role="lines"]');
    const levelEl = root.querySelector('[data-role="level"]');
    const stateEl = root.querySelector('[data-role="state"]');
    const controls = root.querySelector('[data-role="controls"]');
    if (!boardCanvas || !nextCanvas || !controls) return;

    const boardCtx = boardCanvas.getContext("2d");
    const nextCtx = nextCanvas.getContext("2d");
    if (!boardCtx || !nextCtx) return;

    const COLS = 10;
    const ROWS = 20;
    const BLOCK = 24;
    const NEXT_SIZE = 4;
    const START_DROP_MS = 900;
    const MIN_DROP_MS = 120;

    boardCanvas.width = COLS * BLOCK;
    boardCanvas.height = ROWS * BLOCK;
    nextCanvas.width = NEXT_SIZE * BLOCK;
    nextCanvas.height = NEXT_SIZE * BLOCK;

    const TYPES = ["I", "J", "L", "O", "S", "T", "Z"];
    const COLORS = {
      I: "#38bdf8",
      J: "#60a5fa",
      L: "#fb923c",
      O: "#facc15",
      S: "#4ade80",
      T: "#c084fc",
      Z: "#f87171"
    };
    const SHAPES = {
      I: [
        [0, 0, 0, 0],
        [1, 1, 1, 1],
        [0, 0, 0, 0],
        [0, 0, 0, 0]
      ],
      J: [
        [1, 0, 0, 0],
        [1, 1, 1, 0],
        [0, 0, 0, 0],
        [0, 0, 0, 0]
      ],
      L: [
        [0, 0, 1, 0],
        [1, 1, 1, 0],
        [0, 0, 0, 0],
        [0, 0, 0, 0]
      ],
      O: [
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 0, 0, 0],
        [0, 0, 0, 0]
      ],
      S: [
        [0, 1, 1, 0],
        [1, 1, 0, 0],
        [0, 0, 0, 0],
        [0, 0, 0, 0]
      ],
      T: [
        [0, 1, 0, 0],
        [1, 1, 1, 0],
        [0, 0, 0, 0],
        [0, 0, 0, 0]
      ],
      Z: [
        [1, 1, 0, 0],
        [0, 1, 1, 0],
        [0, 0, 0, 0],
        [0, 0, 0, 0]
      ]
    };

    let board = [];
    let current = null;
    let nextType = null;
    let score = 0;
    let lines = 0;
    let level = 1;
    let gameOver = false;
    let hasStarted = false;
    let dropInterval = START_DROP_MS;
    let dropCounter = 0;
    let lastTime = 0;
    let rafId = 0;
    let lastTouchTime = 0;

    function createMatrix(rows, cols) {
      return Array.from({ length: rows }, () => Array(cols).fill(0));
    }

    function cloneMatrix(matrix) {
      return matrix.map((row) => row.slice());
    }

    function randomType() {
      return TYPES[Math.floor(Math.random() * TYPES.length)];
    }

    function createPiece(type) {
      return {
        type,
        matrix: cloneMatrix(SHAPES[type]),
        x: Math.floor((COLS - 4) / 2),
        y: -1
      };
    }

    function collides(matrix, xOffset, yOffset) {
      for (let y = 0; y < matrix.length; y += 1) {
        for (let x = 0; x < matrix[y].length; x += 1) {
          if (!matrix[y][x]) continue;
          const bx = x + xOffset;
          const by = y + yOffset;
          if (bx < 0 || bx >= COLS || by >= ROWS) return true;
          if (by >= 0 && board[by][bx]) return true;
        }
      }
      return false;
    }

    function rotateMatrix(matrix) {
      const size = matrix.length;
      const rotated = createMatrix(size, size);
      for (let y = 0; y < size; y += 1) {
        for (let x = 0; x < size; x += 1) {
          rotated[x][size - 1 - y] = matrix[y][x];
        }
      }
      return rotated;
    }

    function mergeCurrent() {
      const matrix = current.matrix;
      for (let y = 0; y < matrix.length; y += 1) {
        for (let x = 0; x < matrix[y].length; x += 1) {
          if (!matrix[y][x]) continue;
          const bx = x + current.x;
          const by = y + current.y;
          if (by < 0) {
            gameOver = true;
            return;
          }
          board[by][bx] = { type: current.type };
        }
      }
    }

    function clearLines() {
      let cleared = 0;
      outer: for (let y = ROWS - 1; y >= 0; y -= 1) {
        for (let x = 0; x < COLS; x += 1) {
          if (!board[y][x]) continue outer;
        }
        const removed = board.splice(y, 1)[0];
        removed.fill(0);
        board.unshift(removed);
        cleared += 1;
        y += 1;
      }
      if (!cleared) return;

      const points = [0, 100, 300, 500, 800];
      lines += cleared;
      score += points[cleared] * level;
      level = Math.floor(lines / 10) + 1;
      dropInterval = Math.max(MIN_DROP_MS, START_DROP_MS - (level - 1) * 70);
    }

    function updateHud() {
      scoreEl.textContent = String(score);
      linesEl.textContent = String(lines);
      levelEl.textContent = String(level);
      if (!hasStarted) {
        stateEl.textContent = "未开始";
      } else {
        stateEl.textContent = gameOver ? "游戏结束" : "进行中";
      }
    }

    function spawnPiece() {
      const type = nextType || randomType();
      nextType = randomType();
      current = createPiece(type);
      if (collides(current.matrix, current.x, current.y)) {
        gameOver = true;
      }
      updateHud();
    }

    function lockAndContinue() {
      mergeCurrent();
      if (!gameOver) {
        clearLines();
        spawnPiece();
      } else {
        updateHud();
      }
    }

    function move(dx) {
      if (!hasStarted || gameOver || !current) return;
      const nx = current.x + dx;
      if (!collides(current.matrix, nx, current.y)) {
        current.x = nx;
      }
    }

    function rotate() {
      if (!hasStarted || gameOver || !current) return;
      const rotated = rotateMatrix(current.matrix);
      const kicks = [0, -1, 1, -2, 2];
      for (let i = 0; i < kicks.length; i += 1) {
        const nx = current.x + kicks[i];
        if (!collides(rotated, nx, current.y)) {
          current.matrix = rotated;
          current.x = nx;
          return;
        }
      }
    }

    function softDrop() {
      if (!hasStarted || gameOver || !current) return;
      if (!collides(current.matrix, current.x, current.y + 1)) {
        current.y += 1;
        score += 1;
      } else {
        lockAndContinue();
      }
      dropCounter = 0;
      updateHud();
    }

    function hardDrop() {
      if (!hasStarted || gameOver || !current) return;
      let moved = 0;
      while (!collides(current.matrix, current.x, current.y + 1)) {
        current.y += 1;
        moved += 1;
      }
      score += moved * 2;
      lockAndContinue();
      dropCounter = 0;
      updateHud();
    }

    function resetToIdle() {
      board = createMatrix(ROWS, COLS);
      current = null;
      nextType = null;
      score = 0;
      lines = 0;
      level = 1;
      gameOver = false;
      hasStarted = false;
      dropInterval = START_DROP_MS;
      dropCounter = 0;
      lastTime = 0;
      updateHud();
    }

    function startGame() {
      board = createMatrix(ROWS, COLS);
      current = null;
      score = 0;
      lines = 0;
      level = 1;
      gameOver = false;
      hasStarted = true;
      dropInterval = START_DROP_MS;
      dropCounter = 0;
      lastTime = 0;
      nextType = randomType();
      spawnPiece();
      drawAll();
    }

    function restart() {
      if (!hasStarted) return;
      startGame();
    }

    function drawCell(ctx, x, y, color) {
      if (y < 0) return;
      const px = x * BLOCK;
      const py = y * BLOCK;
      ctx.fillStyle = color;
      ctx.fillRect(px + 1, py + 1, BLOCK - 2, BLOCK - 2);

      ctx.fillStyle = "rgba(255,255,255,0.22)";
      ctx.fillRect(px + 1, py + 1, BLOCK - 2, 4);
    }

    function drawGrid(ctx, cols, rows) {
      ctx.strokeStyle = "rgba(148,163,184,0.15)";
      ctx.lineWidth = 1;
      ctx.beginPath();
      for (let x = 0; x <= cols; x += 1) {
        ctx.moveTo(x * BLOCK + 0.5, 0);
        ctx.lineTo(x * BLOCK + 0.5, rows * BLOCK);
      }
      for (let y = 0; y <= rows; y += 1) {
        ctx.moveTo(0, y * BLOCK + 0.5);
        ctx.lineTo(cols * BLOCK, y * BLOCK + 0.5);
      }
      ctx.stroke();
    }

    function drawBoard() {
      boardCtx.fillStyle = "#0f172a";
      boardCtx.fillRect(0, 0, boardCanvas.width, boardCanvas.height);

      for (let y = 0; y < ROWS; y += 1) {
        for (let x = 0; x < COLS; x += 1) {
          if (!board[y][x]) continue;
          drawCell(boardCtx, x, y, COLORS[board[y][x].type]);
        }
      }

      if (current) {
        for (let y = 0; y < current.matrix.length; y += 1) {
          for (let x = 0; x < current.matrix[y].length; x += 1) {
            if (!current.matrix[y][x]) continue;
            drawCell(boardCtx, current.x + x, current.y + y, COLORS[current.type]);
          }
        }
      }

      drawGrid(boardCtx, COLS, ROWS);

      if (!hasStarted) {
        boardCtx.fillStyle = "rgba(2,6,23,0.72)";
        boardCtx.fillRect(0, 0, boardCanvas.width, boardCanvas.height);
        boardCtx.fillStyle = "#f8fafc";
        boardCtx.textAlign = "center";
        boardCtx.font = "bold 21px sans-serif";
        boardCtx.fillText("点击开始", boardCanvas.width / 2, boardCanvas.height / 2 - 8);
        boardCtx.font = "13px sans-serif";
        boardCtx.fillText("按 Enter 也可以开始", boardCanvas.width / 2, boardCanvas.height / 2 + 20);
      } else if (gameOver) {
        boardCtx.fillStyle = "rgba(2,6,23,0.72)";
        boardCtx.fillRect(0, 0, boardCanvas.width, boardCanvas.height);
        boardCtx.fillStyle = "#f8fafc";
        boardCtx.textAlign = "center";
        boardCtx.font = "bold 22px sans-serif";
        boardCtx.fillText("游戏结束", boardCanvas.width / 2, boardCanvas.height / 2 - 8);
        boardCtx.font = "14px sans-serif";
        boardCtx.fillText("点击重开再来一局", boardCanvas.width / 2, boardCanvas.height / 2 + 20);
      }
    }

    function drawNext() {
      nextCtx.fillStyle = "#111827";
      nextCtx.fillRect(0, 0, nextCanvas.width, nextCanvas.height);
      drawGrid(nextCtx, NEXT_SIZE, NEXT_SIZE);
      if (!nextType) return;

      const matrix = SHAPES[nextType];
      for (let y = 0; y < matrix.length; y += 1) {
        for (let x = 0; x < matrix[y].length; x += 1) {
          if (!matrix[y][x]) continue;
          drawCell(nextCtx, x, y, COLORS[nextType]);
        }
      }
    }

    function drawAll() {
      drawBoard();
      drawNext();
      updateHud();
    }

    function step(timestamp) {
      if (!lastTime) lastTime = timestamp;
      const delta = timestamp - lastTime;
      lastTime = timestamp;
      dropCounter += delta;

      if (hasStarted && !gameOver && current && dropCounter >= dropInterval) {
        if (!collides(current.matrix, current.x, current.y + 1)) {
          current.y += 1;
        } else {
          lockAndContinue();
        }
        dropCounter = 0;
      }

      drawAll();
      rafId = window.requestAnimationFrame(step);
    }

    function handleAction(action) {
      if (action === "start") {
        startGame();
        drawAll();
        return;
      }
      if (!hasStarted) return;
      switch (action) {
        case "left":
          move(-1);
          break;
        case "right":
          move(1);
          break;
        case "rotate":
          rotate();
          break;
        case "down":
          softDrop();
          break;
        case "drop":
          hardDrop();
          break;
        case "restart":
          restart();
          break;
        default:
          break;
      }
      drawAll();
    }

    function findActionButton(event) {
      const target = event.target;
      if (!(target instanceof Element)) return null;
      const button = target.closest("button[data-action]");
      if (!button || !controls.contains(button)) return null;
      return button;
    }

    function onControlClick(event) {
      if (Date.now() - lastTouchTime < 450) {
        return;
      }
      const button = findActionButton(event);
      if (!button) return;
      handleAction(button.dataset.action);
    }

    function onControlTouch(event) {
      const button = findActionButton(event);
      if (!button) return;
      event.preventDefault();
      lastTouchTime = Date.now();
      handleAction(button.dataset.action);
    }

    function onKeyDown(event) {
      const target = event.target;
      if (
        target instanceof HTMLElement &&
        (target.tagName === "INPUT" || target.tagName === "TEXTAREA" || target.isContentEditable)
      ) {
        return;
      }

      let action = "";
      switch (event.key) {
        case "Enter":
          action = "start";
          break;
        case "ArrowLeft":
          action = "left";
          break;
        case "ArrowRight":
          action = "right";
          break;
        case "ArrowUp":
          action = "rotate";
          break;
        case "ArrowDown":
          action = "down";
          break;
        case " ":
          action = "drop";
          break;
        case "r":
        case "R":
          action = "restart";
          break;
        default:
          break;
      }

      if (!action) return;
      event.preventDefault();
      handleAction(action);
    }

    controls.addEventListener("click", onControlClick);
    controls.addEventListener("touchstart", onControlTouch, { passive: false });
    document.addEventListener("keydown", onKeyDown);

      window.__gamesTetrisCleanup = () => {
      if (rafId) {
        window.cancelAnimationFrame(rafId);
      }
      controls.removeEventListener("click", onControlClick);
      controls.removeEventListener("touchstart", onControlTouch);
      document.removeEventListener("keydown", onKeyDown);
      window.__gamesTetrisCleanup = null;
    };

    resetToIdle();
    drawAll();
    rafId = window.requestAnimationFrame(step);
  })();
</script>


  

</article>



              </div>
            </div>
          </div>
        </div>
      </div>
    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



<script>
  window.socialFloatConfig = {};
</script>


  
<script src="/js/canvas-nest.min.js"></script>
<script src="/js/click-love.js"></script>
<script src="/js/cool-effects.js"></script>
<script src="/js/click-text.js"></script>



<!-- 代码高亮主题切换器 -->

  <script  src="/js/highlight-theme-switcher.js" ></script>


<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
